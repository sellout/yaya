{"jobs":{"build":{"env":{"CONFIG":"--enable-benchmarks --enable-tests --allow-newer=yaya:all,yaya-containers:all,yaya-examples:all,yaya-hedgehog:all,yaya-lens:all,yaya-native:all,yaya-quickcheck:all,yaya-unsafe:all --allow-older=yaya:all,yaya-containers:all,yaya-examples:all,yaya-hedgehog:all,yaya-lens:all,yaya-native:all,yaya-quickcheck:all,yaya-unsafe:all ${{ matrix.bounds }}"},"runs-on":"${{ matrix.os }}","steps":[{"uses":"actions/checkout@v6"},{"id":"setup-haskell-cabal","uses":"haskell-actions/setup@v2","with":{"cabal-version":"3.16.0.0","ghc-version":"${{ matrix.ghc }}"}},{"run":"cabal v2-freeze $CONFIG"},{"uses":"actions/cache@v4","with":{"key":"${{ matrix.os }}-${{ matrix.ghc }}-build-${{ hashFiles('cabal.project.freeze') }}","path":"${{ steps.setup-haskell-cabal.outputs.cabal-store }}\ndist-newstyle\n","restore-keys":"${{ matrix.os }}-${{ matrix.ghc }}-build\n${{ matrix.os }}-${{ matrix.ghc }}\n"}},{"run":"cabal v2-build all $CONFIG"},{"run":"cabal v2-test all $CONFIG"},{"run":"mv dist-newstyle/cache/plan.json plan-${{ matrix.os }}-${{ matrix.ghc }}${{ matrix.bounds }}.json"},{"name":"Upload build plan as artifact","uses":"actions/upload-artifact@v4","with":{"name":"plan-${{ matrix.os }}-${{ matrix.ghc }}${{ matrix.bounds }}","path":"plan-${{ matrix.os }}-${{ matrix.ghc }}${{ matrix.bounds }}.json"}}],"strategy":{"fail-fast":false,"matrix":{"bounds":["--prefer-oldest",""],"exclude":[{"ghc":"8.8.1","os":"macos-15"},{"ghc":"8.8.1","os":"ubuntu-24.04-arm"},{"ghc":"8.10.1","os":"macos-15"},{"ghc":"8.10.1","os":"ubuntu-24.04-arm"},{"ghc":"9.0.1","os":"macos-15"},{"ghc":"9.0.1","os":"ubuntu-24.04-arm"},{"bounds":"","ghc":"8.8.1","os":"macos-15-intel"},{"bounds":"","ghc":"8.10.1","os":"macos-15-intel"},{"ghc":"8.8.1","os":"windows-2025"},{"ghc":"8.10.1","os":"windows-2025"},{"ghc":"9.2.1","os":"macos-15"},{"ghc":"9.2.1","os":"ubuntu-24.04-arm"},{"ghc":"9.4.1","os":"macos-15"},{"ghc":"9.4.1","os":"windows-2025"}],"ghc":["8.8.1","8.10.1","9.0.1","9.2.1","9.4.1","9.6.1","9.8.1","9.10.1","9.12.1","9.14.1"],"include":[{"bounds":"","ghc":"8.10.7","os":"macos-15-intel"},{"bounds":"--prefer-oldest","ghc":"8.10.7","os":"windows-2025"},{"bounds":"","ghc":"8.10.7","os":"windows-2025"},{"bounds":"--prefer-oldest","ghc":"9.2.8","os":"macos-15"},{"bounds":"","ghc":"9.2.8","os":"macos-15"},{"bounds":"--prefer-oldest","ghc":"9.4.8","os":"macos-15"},{"bounds":"","ghc":"9.4.8","os":"macos-15"},{"bounds":"--prefer-oldest","ghc":"9.2.8","os":"ubuntu-24.04-arm"},{"bounds":"","ghc":"9.2.8","os":"ubuntu-24.04-arm"},{"bounds":"--prefer-oldest","ghc":"9.4.8","os":"windows-2025"},{"bounds":"","ghc":"9.4.8","os":"windows-2025"}],"os":["macos-15","macos-15-intel","ubuntu-24.04","ubuntu-24.04-arm","windows-2025"]}}},"check-bounds":{"if":"always()","needs":["build"],"runs-on":"ubuntu-24.04","steps":[{"uses":"actions/checkout@v6"},{"id":"setup-haskell-cabal","uses":"haskell-actions/setup@v2","with":{"cabal-version":"3.16.0.0","ghc-version":"9.10.3"}},{"uses":"actions/cache@v4","with":{"key":"${{ matrix.os }}-${{ matrix.ghc }}-cabal-plan-bounds","path":"${{ steps.setup-haskell-cabal.outputs.cabal-store }}\ndist-newstyle\n","restore-keys":"${{ matrix.os }}-${{ matrix.ghc }}\n"}},{"run":"cabal install cabal-plan-bounds"},{"name":"download Cabal plans","uses":"actions/download-artifact@v4","with":{"merge-multiple":true,"path":"plans","pattern":"plan-*"}},{"name":"Cabal plans considered in generated bounds","run":"find plans/"},{"name":"check if bounds have changed","run":"diffs=\"$(find . -name '*.cabal' -exec \\\n  cabal-plan-bounds \\\n    --dry-run \\\n    --also QuickCheck-2.15.0.1 --also yaya-0.5.1.0 --also yaya-0.6.0.0 --also yaya-hedgehog-0.2.1.0 --also yaya-hedgehog-0.3.0.0  \\\n    plans/*.json \\\n    --cabal {} \\;)\"\nif [[ -n \"$diffs\" ]]; then\n  echo \"$diffs\"\n  exit 1\nfi\n"}]},"check-licenses":{"if":"always()","needs":["build"],"runs-on":"ubuntu-24.04","steps":[{"uses":"actions/checkout@v6"},{"id":"setup-haskell-cabal","uses":"haskell-actions/setup@v2","with":{"cabal-version":"3.16.0.0","ghc-version":"9.10.3"}},{"uses":"actions/cache@v4","with":{"key":"${{ matrix.os }}-${{ matrix.ghc }}-cabal-plan","path":"${{ steps.setup-haskell-cabal.outputs.cabal-store }}\ndist-newstyle\n","restore-keys":"${{ matrix.os }}-${{ matrix.ghc }}\n"}},{"run":"cabal install cabal-plan \\\n  --flags='exe license-report' \\\n  --ghc-options='-Wwarn'\n"},{"name":"download Cabal plans","uses":"actions/download-artifact@v4","with":{"merge-multiple":true,"path":"plans","pattern":"plan-*"}},{"run":"mkdir -p dist-newstyle/cache\nmv plans/plan-ubuntu-24.04-9.10.1.json dist-newstyle/cache/plan.json\n"},{"name":"check if licenses have changed","run":"declare -A packages=([yaya]=core [yaya-containers]=containers [yaya-examples]=examples [yaya-hedgehog]=hedgehog [yaya-lens]=lens [yaya-native]=native [yaya-quickcheck]=quickcheck [yaya-unsafe]=unsafe)\nfor package in \"${!packages[@]}\"; do\n  {\n    echo \"**NB**: This captures the licenses associated with a particular set of dependency versions. If your own build solves differently, itâ€™s possible that the licenses may have changed, or even that the set of dependencies itself is different. Please make sure you run [\\`cabal-plan license-report\\`](https://hackage.haskell.org/package/cabal-plan) on your own components rather than assuming this is authoritative.\"\n    echo\n    cabal-plan license-report \"$package:lib:$package\"\n  } >\"${packages[$package]}/docs/license-report.md\"\ndone\ngit diff --exit-code */docs/license-report.md\n"}]}},"name":"CI","on":{"pull_request":{"types":["opened","synchronize"]},"push":{"branches":["main"]}}}